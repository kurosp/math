:root{
  --chat-font: 13px;      /* chữ nhỏ lại */
  --line: 1.35;           /* sát hơn */
  --pad: 8px;             /* padding nhỏ */
  --radius: 14px;
  --btn-font: 11px;
  --math-scale: 0.86;     /* scale công thức */
  --composer-h: 56px;    /* chiều cao thanh nhập */
  --kbd-offset: 0px;     /* sẽ set bằng JS theo bàn phím */
}

body { font-family: system-ui, Arial; margin: 0; background:#f6f7fb; padding-bottom: calc(var(--composer-h) + env(safe-area-inset-bottom, 0px)); }
.wrap { max-width: 100%; margin: 0 auto; padding: 12px; }

.chat{
  background:#fff; border-radius: var(--radius); padding: 10px;
  height: calc(100dvh - 120px); overflow:auto;
  padding-bottom: calc(10px + var(--composer-h) + var(--kbd-offset) + env(safe-area-inset-bottom, 0px));
  box-shadow: 0 6px 20px rgba(0,0,0,.06);
}

.msgrow { margin: 8px 0; display:flex; }
.me { justify-content:flex-end; }
.bot { justify-content:flex-start; }

.bubble{
  position: relative;
  max-width: 90%;
  padding: var(--pad);
  border-radius: var(--radius);
  line-height: var(--line);
  font-size: var(--chat-font);
  white-space: normal;
  overflow: hidden;
}

.me .bubble { background:#2b6cff; color:#fff; border-bottom-right-radius: 6px; }
.bot .bubble {  padding: 12px 12px 44px 12px;
  position: relative;

  background:#f0f2f7; color:#111;
  border-bottom-left-radius: 6px;
  contain: content;
}

/* text dài không có khoảng trắng */
.bubble, .bubble * { overflow-wrap: anywhere; word-break: break-word; }

.copy-btn{position:absolute;left:10px;right:auto;bottom:10px;width:32px;height:32px;display:grid;place-items:center;border-radius:10px;border:1px solid rgba(30,30,30,.55);background:#f0f2f7;color:#222;box-shadow:none;opacity:.95;}
.copy-btn:hover{opacity:1;}
.copy-btn svg{width:16px;height:16px;}
.copy-btn.copied{border-color:rgba(30,30,30,.55);background:#f0f2f7;}
.bot .bubble:hover .copy-btn{position:absolute;left:10px;right:auto;bottom:10px;width:32px;height:32px;display:grid;place-items:center;border-radius:10px;border:1px solid rgba(30,30,30,.55);background:#f0f2f7;color:#222;box-shadow:none;opacity:.95;}
.copy-btn:hover{opacity:1;}
.copy-btn svg{width:16px;height:16px;}
.copy-btn.copied{border-color:rgba(30,30,30,.55);background:#f0f2f7;}
.copy-btn svg{ width:16px; height:16px; }
.copy-btn.copied{ border-color: rgba(34,197,94,.6); background: rgba(34,197,94,.12); }
.copy-btn svg{ width: 16px; height: 16px; opacity: .78; }
.copy-btn:active{ transform: scale(.96); }
.copy-btn.copied svg{ opacity: 1; }


#composer{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  display:flex; gap:10px;
  padding: 10px 12px;
  padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
  background: rgba(246,247,251,.94);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top: 1px solid rgba(0,0,0,.06);
  z-index: 60;
  transform: translateY(calc(-1 * var(--kbd-offset)));
}
#composer input{
  flex:1;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid #d9dce7;
  outline: none;
  box-sizing: border-box;
  font-size: 14px; /* ô nhập vẫn dễ nhìn */
}
button{
  padding: 10px 12px;
  border-radius: 12px;
  border: none;
  background:#111;
  color:#fff;
  cursor:pointer;
}
button:disabled{ opacity:.6; cursor:not-allowed; }
.hint { font-size: 11px; opacity: .7; margin-top: 6px; line-height: 1.25; }

/* MathJax: chữ nhỏ + nếu dài thì cuộn ngang trong chính bubble */
.bot mjx-container{
  font-size: calc(var(--chat-font) * var(--math-scale)) !important;
  max-width: 100% !important;
  overflow-x: auto !important;    /* công thức dài -> cuộn ngang */
  overflow-y: hidden !important;
  display:block;
  -webkit-overflow-scrolling: touch;
}

/* Status/cooldown banner */
.status{
  margin-top: 8px;
  padding: 8px 10px;
  border-radius: 12px;
  background: #fff3cd;
  border: 1px solid rgba(0,0,0,.08);
  font-size: 12px;
  line-height: 1.25;
  opacity: .95;
}


/* Typing overlay */
  40% { transform: translateY(-6px); opacity: 1; }
}
/* ===== topbar ===== */
.topbar{position:relative;
  position: sticky;
  top: 0;
  z-index: 40;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 12px;
  margin-bottom: 10px;
  border-radius: 16px;
  background: rgba(255,255,255,.86);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 8px 24px rgba(0,0,0,.06);
}
.topbar__left{ display:flex; align-items:center; gap:10px; min-width: 0; }
.topbar__avatar{
  width: 38px; height: 38px;
  border-radius: 999px;
  display:flex; align-items:center; justify-content:center;
  font-weight: 700;
  background: linear-gradient(135deg, #2b6cff, #8a5cff);
  color:#fff;
  flex: 0 0 auto;
}
.topbar__title{ font-weight: 700; letter-spacing: .2px; }
.topbar__sub{ font-size: 12px; opacity:.75; display:flex; align-items:center; gap:6px; }
.dot{ width:8px; height:8px; border-radius:999px; background:#2ecc71; box-shadow:0 0 0 3px rgba(46,204,113,.15); }
.scroll-bottom{
  width: 38px; height: 38px;
  border-radius: 999px;
  background: rgba(0,0,0,.06);
  color:#111;
  display:flex; align-items:center; justify-content:center;
  opacity: 0;
  transition: opacity .2s ease;
}
.scroll-bottom svg{ width: 20px; height: 20px; }

/* ===== messenger-like chat background ===== */
body{
  background: radial-gradient(1200px 800px at 20% -10%, rgba(43,108,255,.20), transparent 60%),
              radial-gradient(900px 700px at 110% 10%, rgba(138,92,255,.16), transparent 55%),
              #f6f7fb;
}
#chat{
  background: rgba(255,255,255,.82);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

/* ===== typing bubble (no full-screen overlay) ===== */
.msgrow.typing .bubble{
  position: relative;
  padding: 10px 12px;
}
.typing-inline{
  display:flex;
  align-items:center;
  gap: 6px;
}
.typing-inline span{
  width: 6px; height: 6px;
  border-radius: 999px;
  background: rgba(0,0,0,.45);
  animation: typingDot 1.2s infinite ease-in-out;
}
.typing-inline span:nth-child(2){ animation-delay: .15s; }
.typing-inline span:nth-child(3){ animation-delay: .3s; }
@keyframes typingDot{
  0%, 100%{ transform: translateY(0); opacity: .45; }
  50%{ transform: translateY(-3px); opacity: .95; }
}

/* ===== prevent MathJax overflow ===== */
.bubble .mjx-container{
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
}


/* --- textarea autosize --- */
#msg{
  width:100%;
  border: none;
  outline: none;
  background: transparent;
  font: inherit;
  line-height: 1.35;
  resize: none;
  overflow: hidden;
  min-height: 22px;
  max-height: 140px;
  padding: 0;
}
.composer .input{
  display:flex;
  align-items:flex-end;
  gap:10px;
}
.composer .textwrap{
  flex:1;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.95);
}


/* top clear button */
.topbar__center{position:absolute;left:50%;transform:translateX(-50%);}
.clear-top{display:flex;align-items:center;gap:6px;font-size:12px;line-height:1;padding:6px 10px;border-radius:999px;background:rgba(240,242,247,.92);border:1px solid rgba(0,0,0,.22);color:#111;}
.clear-top .ico{width:16px;height:16px;fill:currentColor;opacity:.85;}
.clear-top:active{transform:translateY(1px);}

/* composer tweaks */
.inputbar{gap:8px;}
#msg{flex:1;min-width:0;}
#send{width:56px;min-width:56px;height:44px;padding:0;border-radius:14px;display:grid;place-items:center;}


/* ===== UI fixes v5 ===== */
.bar.inputbar{
  display:flex;
  align-items:flex-end;
  gap:12px;
  width:100%;
}
.bar.inputbar .inputwrap{ flex:1; min-width:0; }
#msg{
  width:100%;
  min-height:44px;
  height:auto;
  max-height:160px;
  overflow:auto;
  line-height:1.35;
}
#send{
  margin-left:auto;
  flex:0 0 auto;
}

/* Wider bubbles (but never overflow) */
.msgrow .bubble{
  max-width: 100%;
}
.msgrow.me .bubble{
  max-width: 100%;
}

/* Copy icon: tiny, no square border, bottom-left */
.msgrow.bot .bubble{ position:relative; padding-bottom:32px; }
.copy-btn{
  position:absolute;
  left:12px;
  bottom:10px;
  width:18px;
  height:18px;
  padding:0;
  border:none;
  background:transparent;
  color: rgba(0,0,0,.55);
}
.copy-btn svg{ width:18px; height:18px; display:block; }

/* Home button */
.home-btn{
  position: fixed;
  top: 78px;
  right: 16px;
  width: 42px;
  height: 42px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-decoration:none;
  background: rgba(255,255,255,.9);
  border: 1px solid rgba(0,0,0,.12);
  box-shadow: 0 8px 20px rgba(0,0,0,.10);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}
